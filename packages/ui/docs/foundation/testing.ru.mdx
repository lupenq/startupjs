# Тестирование

Для e2e тестирование на мобильных платформах в Styleguide используется библиотека [Detox](https://github.com/wix/Detox) и test-runner [Jest](https://jestjs.io/)

## Запуск тестов

Для локального запуска тестирования Styleguide необходимо выполнить следующие команды:
  - `yarn test:build:ios` - соберет приложение iOS (обязательно в первый раз и после установки новых пакетов)
  - `yarn test` - запустит тесты


## Написание тестов

В первую очередь вам необходимо ознакомиться с документацией [API Detox](https://github.com/wix/Detox/tree/master/docs#api-reference). Здесь можно найти все стандартные команды для тестирования.

### Создание файла с тестами

В корне папки компонента создайте файл `*.e2e.js` и добавте в него минимальный шаблон:

```js
describe('Example', () => {
  it('should visible button', async () => {
    await x('#button').toBeVisible()
  })
})
```

### testID

detox умеет находить элементы по `id` как это делается в традиционном `html`. Для того чтобы присвоить `id` компоненту передайте ему пропс `testID` со значением `id`. Например:

```pug
Button(
  testID='confirmButton'
  onPress=() => console.log('confirm')
) Confirm
```

Таким образом мы сможем найти данный компонент по `x('#confirmButton')`.

### Функция `x`

Для выбора нужного компонента в приложении используется функция `x`, она может принимать следующие значения:
- Поиск по `testID` - должно начинаться с `#`, например: `x('#myButton')`
- Поиск по тексту - должно начинаться с `= `, например: `x('= Подписаться')`
- Поиск по типу - просто название типа, например: `x('UIPickerView')` для `Select`

Данная функция упрощает взаимодействие с Detox API. Она полностью заменяет функции поиска элемента в проекте.

Также `x` поддерживает поиск вложенных элементов. К примеру, у нас есть компонент с текстом `Test text`, который вложен в компонент с `testID='parentComponent'`:

```pug
Div(testID='parentComponent')
  Span Test text
```

Тогда чтобы получить компонент `Span Test text` нам необходимо вызвать `x` следующим образом:

```js
x('#parentComponent ="Test text"')
```

Это крайне полезно в ситуациях, когда одинаковые вложенные элементы имеют различных родителей. Например:

```pug
Div(testID='grandParent')
  Div(testID='parentComponent1')
    Span Test text
  Div(testID='parentComponent2')
    Span Test text
```

В данном случае у нас одинаковый текст в различных родителях. Чтобы получить `Span`, который вложен в `parentComponent2` нужно использовать:

```js
x('#parentComponent2 ="Test text"')
```

# Действия

После того как мы нашли элемент, к нему можно применять некоторые действия. Например нажать на него, ввести текст и так далее. Все доступные действия над элементом можно увидеть в [сооветствующем разделе документации Detox](https://github.com/wix/Detox/blob/master/docs/APIRef.ActionsOnElement.md).

Давайте разберем несколько основных действий, чтобы понять принцип их работы.

## .tap()
`.tap()` позволяет нажать на элемент. То есть, чтобы проверить работу, например, кнопки, на нее необходимо нажать и так далее. Важно помнить, что данное действие можно применить к любому элементу. Пусть у нас есть форма, которая содержит две кнопки (принять и отклонить):

```pug
Div(testID='userForm')
  // any code
  Button(
    testID='acceptButton'
    onPress=() => console.log('accept')
  ) Accept
  Button(
    testID='dismissButton'
    onPress=() => console.log('dismiss')
  ) Dismiss
```

Для того, чтобы проверить поведение приложения после нажатия на кнопку `Accept`, необходимо выполнить следующие действия:
1. Найти элемент который соответствует кнопке `Accept`
2. Вызвать у него метод `.tap`.

```js
x('#acceptButton').tap()
```

Таким образом мы произвели нажатие на кнопку `Accept`.

## .typeText(text)
`.typeText(text)` позволяет ввести в элемент текст. Это необходимо для проверки заполнения полей ввода. Пусть у нас есть форма, которая содержит поля ввода:

```pug
Div(testID='userForm')
  TextInput(
    testID='userNameInput'
    label='Name'
    value=userName
    onChangeText=setUserName
  )
  TextInput(
    testID='userSurnameInput'
    label='Surname'
    value=userSurname
    onChangeText=setUserSurname
  )
```

Давайте заполним поля вода `Name` и `Surname`.

```js
x('#userNameInput').typeText('Harry')
x('#userSurnameInput').typeText('Potter')
```